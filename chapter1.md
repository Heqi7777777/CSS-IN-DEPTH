# 第1章 层叠、优先级和继承

CSS本质上就是声明规则，即在各种条件下，我们希望产生特定的效果。如果你发现有一条规则并没有按照预期生效，可能是因为另一条规则跟它冲突了。层叠指的就是这一系列规则。它决定了如何解决冲突，是**CSS**语言的基础。

## 1.1 层叠

**层叠的规则**：当声明冲突时，层叠会根据三种条件解决冲突。

（1）**样式表的来源**：样式表是从哪里来的，包括你的样式和浏览器默认样式等。

（2）**选择器的优先级**：哪些选择器比另一些选择器更重要。

（3）**源码顺序**： 样式在样式表里的声明顺序。

当冲突的来源或者重要性不同，使用更高优先级的来源里的声明；当来源或重要性相同，判断是不是内联样式，如果是，则使用内联样式；否则判断选择器是否有不同的优先级，如果有，使用更高优先级的声明；如果优先级一样，使用源码顺序里较晚出现的声明。

**术语解释：**

**声明**：CSS中的一行被称作一个声明。例如：

```css
color: red;
```

**声明块**：包含在大括号中的一组声明被称作一个声明块。声明块前面有一个**选择器**（如下面的body)。例如：

```css
body {
    color: red;
    font-family: Helvetica;
}
```

选择器和声明块一起组成了**规则集**，简称**规则**。

**@规则**：是指用“@”符号开头的语法。比如@import规则或者@media查询。

### 1.1.1 样式表的来源

样式表来源主要有**作者样式表**和**用户代理样式表**（即浏览器默认样式）。作者样式表的样式优先级高，会覆盖用户代理样式表。有些浏览器允许用户定义一个**用户样式表**，这是第三种来源，它的优先级介于用户代理样式表和作者样式表之间。用户样式表比较少见，并且不受网站作者控制，因此不讨论。

样式来源规则有一个例外：标记为important的声明，会被当作更高优先级的来源，例如：

```css
color: red !important;
```

因此总体的优先级按照由高到低排列为：**作者的 !important  > 作者 > 用户代理**

### 1.1.2 理解优先级

浏览器将优先级分为两部分： HTML的**行内样式**和**选择器的样式**。

1. **行内样式**

   如果用HTML的style属性写样式，这个声明只会作用于当前元素。行内元素属于“带作用域的”声明，它会覆盖任何来自样式表或者<style>标签的样式。

   ```html
   <a href='/specials' style="backgroud-color: orange;">Specials</a>
   ```

   为了在样式表里覆盖行内声明，需要为声明添加 !important，这样能将它提升到一个更高优先级的来源。但如果行内样式也被标记为 !important，就无法覆盖它了。最好是只在样式表里用!important。

2. **选择器优先级**

​		不同类型的选择器有不同的优先级。总体优先级是：**ID选择器 > 类选择器 >标签选择器**。优先级的准确规则如下：

- 如果选择器的ID数量更多，则它会胜出
- 如果ID数量一致，那么拥有最多类的选择器胜出
- 如果以上两次比较都一致，那么拥有最多标签名的选择器胜出

**ID选择器**:

```css
#page-title {
    color: red;
}
```

**类选择器**:

```css
.page-title {
    color: red;
}
```

**标签选择器**:

```css
body {
    color: red;
}
```

注：伪类选择器（如:hover)和属性选择器（如[type="input"]）与一个类选择器的优先级相同。通用选择器（*）和组合器（>、+、~）对优先级没有影响。

**综上：** **!important  > 行内样式>ID选择器 > 类选择器 >标签选择器 > 用户代理**

通常最好让优先级尽可能低，这样当需要覆盖一些样式时，才能有选择空间。首先确定哪些声明可以实现效果；其次，可以思考用哪些选择器结构，然后选择最符合需求哪个。

### 1.1.3 源码顺序

如果两个声明的来源和优先级相同，其中一个声明在样式表种出现较晚，或者位于页面较晚引入的样式表种，则该声明胜出。

1. **链接样式和源码顺序**

给链接加样式要按照一定的顺序书写选择器，这是因为源码顺序影响了层叠。“正确”的链接样式顺序如下所示：

```css
a:link{
    color: blue;
    text-decoration: none;
}

a:visited{
    color: purple;
}

a:hover{
    text-decoration: underline;
}

a:active {
    color: red;
}
```

优先级相同时，后出现的样式会覆盖先出现的样式。如果一个元素同时处于两个或者更多状态，最后一个状态就能覆盖其他状态。

​	2. **层叠值**

浏览器遵循三个步骤，即来源、优先级、源码顺序，来解析网页上每个元素的每个属性。如果一个声明在层叠中胜出，它就被称作一个**层叠值**。元素的每个属性最多只有一个层叠值。层叠值作为层叠结果，应用到一个元素上的特定属性的值。

### 1.1.4 两条经验法则

（1）在选择器中不要使用ID

（2）不要使用 !important。

## 1.2 继承

还有一种给元素添加样式的方式：继承。如果一个元素没有层叠值，则可能会继承某个祖先元素的值。但不是所有的属性都能被继承。默认情况下，只有特定的一些属性能被继承，通常是我们希望被继承的哪些。它们主要包括：

（1）跟文本相关的属性：color、font、font-family、font-size、font-weight、font-variant、font-style、line-height、letter-spacing、text-align、text-indent、text-transform、white-space以及word-spacing

（2）列表属性：list-style、list-style-type、list-style-position、list-style-image

（3）表格的边框属性：border-collapse、border-spacing。（注：控制表格的边框行为，而不是常用于指定非表格元素边框的属性。）

注：**以上为不完全枚举**

## 1.3 特殊值

有两个特殊值可以赋给任意属性，用于控制层叠：**inherit**和**initial**。

### 1.3.1 使用inherit关键字

有时候，我们想用继承代替一个层叠值，这时可以用**inherit**关键字。这么做的好处是如果父元素的对应属性发生变化，子元素的对应元素也会跟着变化。

还可以用inherit关键字强制继承一个通常不会被继承的属性，比如边框和内边距。

### 1.3.2 使用initial关键字

有时候，你需要撤销作用于某个元素的样式，这可以用initial关键字来实现。每一个CSS属性都有初始（默认）值。如果将initial值赋给某个属性，那么就会有效地将其重置为默认值，这种操作相当于硬复位了该值。

注：auto不是所有属性的默认值，对很多属性来说甚至不是合法的值。比如border-width:auto是非法的，因此不会生效。直接使用initial更简单。

## 1.4 简写属性

**简写属性**是用于同时给多个属性赋值的属性。例如：

- **font:** 可以用于设置多种字体属性，它指定了font-style、font-weight、font-size、font-height、font-family
- **background**: background-color、background-image、background-size、background-repeat、background-position、background-chip、background-attachment
- **border**: border-width、border-style和border-color的简写属性，而这几个属性页都是简写属性
- **border-width**是上、右、下、左四个边框宽度的间歇属性

### 1.4.1 简写属性会默默覆盖其他样式

大多数简写属性可以省略一些值，只指定我们关注的值。但是要知道，这样做仍然会设置省略的值，即它们会被隐式地设置为初始值。这会默默覆盖在其他地方定义的样式。比如，使用简写属性font时如果省略font-weight, 那么字体粗细就会被设置为normal。这些样式也会覆盖从祖先元素继承的字体样式。

### 1.4.2 理解简写值的顺序

简写属性会尽量包容指定的属性值的顺序。但有很多属性的值很模糊，在这种情况下值的顺序很关键。

1. ##### 上、右、下、左

当遇到像margin、padding这样的属性，还有为元素的四条边分别指定值的边框属性时，这些值是按顺时针方向，从上边开始的。这种模式下的属性值还可以缩写，没有指定的边会取对边的值。即，**无论指定了几个值，反正按上、右、下、左的顺序对应，没有的取对边的值**。如果只指定了一个值，则四个方向都会使用这个值。

2. ##### 水平、垂直

有一些属性只支持最多指定两个值，这些属性包括background-position、box-shadow、text-shadow。这些属性的值首先指定水平方向的左/右属性值，然后才是垂直方向的上/下属性值。例如：box-shadow: 10px 2px表示阴影向右偏移10px、向下偏移2px。

总之，如果属性需要指定从一个点触发的两个方向的值，就想想“笛卡尔网格”；如果属性需要指定一个元素四个方向的值，就想想“时钟”。
